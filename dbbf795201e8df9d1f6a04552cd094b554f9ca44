{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "a0c2820a_be2c36e8",
        "filename": "src/system/libroot/posix/pthread/pthread.cpp",
        "patchSetId": 3
      },
      "lineNbr": 161,
      "author": {
        "id": 1000023
      },
      "writtenOn": "2022-03-21T08:50:11Z",
      "side": 1,
      "message": "now invalidTime is always false.\nThe usual expectation in pthreads is, if the operation can succeed immediately, it shouldn\u0027t fail because of an invalid timeout.",
      "revId": "dbbf795201e8df9d1f6a04552cd094b554f9ca44",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "014d3189_6f04271e",
        "filename": "src/system/libroot/posix/pthread/pthread.cpp",
        "patchSetId": 3
      },
      "lineNbr": 161,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2022-03-22T07:06:41Z",
      "side": 1,
      "message": "It seems like the behaviour in Linux never results in EINVAL (probably why I didn\u0027t see in a different man page). If it\u0027s less than 0, then it acts like pthread_tryjoin_np, returning ETIMEDOUT, else it blocks like regular pthread_join from my tests. If that sounds like a satisfactory implementation, I can do that.",
      "parentUuid": "a0c2820a_be2c36e8",
      "revId": "dbbf795201e8df9d1f6a04552cd094b554f9ca44",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3e87389c_942a4a13",
        "filename": "src/system/libroot/posix/pthread/pthread.cpp",
        "patchSetId": 3
      },
      "lineNbr": 161,
      "author": {
        "id": 1000001
      },
      "writtenOn": "2022-03-22T08:01:41Z",
      "side": 1,
      "message": "It should be EINVAL in the case where tv_nsec is larger than 1000000000 nanoseconds (1 second). That\u0027s a malformed timespec structure and isn\u0027t allowed.\n\nIt should be ETIMEDOUT if the time passed in is in the past (but wait_for_thread_etc will take care of that, I think?).\n\nI\u0027m not sure what should happen if abstime is NULL (but wait is true), shouldn\u0027t that behave the same as the non-timeout version? In that case I think the \u0027bool wait\u0027 parameter should not be needed (there is a timeout if abstime !\u003d NULL, and there isn\u0027t if abstime \u003d\u003d NULL). Thqt\u0027s not documented in the manpages, but it is what I would expect by analogy with other \"timed\" methods (for example Linux syscalls ppoll, pselect, epoll_pwait2 behave this way).",
      "parentUuid": "014d3189_6f04271e",
      "revId": "dbbf795201e8df9d1f6a04552cd094b554f9ca44",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "714d7c01_a8188496",
        "filename": "src/system/libroot/posix/pthread/pthread.cpp",
        "patchSetId": 3
      },
      "lineNbr": 161,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2022-03-22T08:10:19Z",
      "side": 1,
      "message": "There is no point in returning EINVAL after the join, as by that point, it would\u0027ve joined the thread, so either it happens before the join, or we don\u0027t return EINVAL at all.",
      "parentUuid": "3e87389c_942a4a13",
      "revId": "dbbf795201e8df9d1f6a04552cd094b554f9ca44",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d69de020_4406c03f",
        "filename": "src/system/libroot/posix/pthread/pthread.cpp",
        "patchSetId": 3
      },
      "lineNbr": 161,
      "author": {
        "id": 1000001
      },
      "writtenOn": "2022-03-22T08:14:30Z",
      "side": 1,
      "message": "Yes, this case should be checked before doing anything else (as it is now).",
      "parentUuid": "714d7c01_a8188496",
      "revId": "dbbf795201e8df9d1f6a04552cd094b554f9ca44",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "236c5287_51ef1e2b",
        "filename": "src/system/libroot/posix/pthread/pthread.cpp",
        "patchSetId": 3
      },
      "lineNbr": 161,
      "author": {
        "id": 1000023
      },
      "writtenOn": "2022-03-22T17:30:19Z",
      "side": 1,
      "message": "If the time is invalid, the join should be tried with a zero relative timeout: either it succeeds, or it should return EINVAL.",
      "parentUuid": "d69de020_4406c03f",
      "revId": "dbbf795201e8df9d1f6a04552cd094b554f9ca44",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8096b817_2f8d13a4",
        "filename": "src/system/libroot/posix/pthread/pthread.cpp",
        "patchSetId": 3
      },
      "lineNbr": 161,
      "author": {
        "id": 1000011
      },
      "writtenOn": "2024-07-16T02:19:53Z",
      "side": 1,
      "message": "musl at least returns EINVAL immediately before even waiting if passed an invalid timespec here. So I think it\u0027s OK if we do the same, and that\u0027s what I\u0027ve done in this change.",
      "parentUuid": "236c5287_51ef1e2b",
      "revId": "dbbf795201e8df9d1f6a04552cd094b554f9ca44",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    }
  ]
}