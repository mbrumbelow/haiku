{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "711f907e_f22d03da",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000341
      },
      "writtenOn": "2021-12-17T13:42:34Z",
      "side": 1,
      "message": "I know that this is not a nice and clean patch but somehow we need to tackle the following situation:\n* there\u0027s different kernel load base for 32-bit and 64-bit architectures\n* the current EFI implementation uses whichever is defined in the arch headers\n* but on the x86 both of them are defined\n* we need to use KERNEL_LOAD_BASE on x86 32-bit, KERNEL_LOAD_BASE_64_BIT on x86_64. So we can\u0027t say either one takes precedence.\n\nWhat could be a better way of achieving this, without introducing arch-dependent ifdefs in the code?",
      "revId": "d2b138e92d4363fa195763f82d7160606b27cd28",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dc107fa6_6cf82e3f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000001
      },
      "writtenOn": "2021-12-17T13:48:58Z",
      "side": 1,
      "message": "KERNEL_LOAD_BASE_64BIT is already a hack to support 32 and 64bit booting in x86_64, it was already annoying, and this is making it worse.\n\nI would prefer that all architectures have only KERNEL_LOAD_BASE (no matter if they are 32 or 64bit) and the special case to handle 32 and 64bit in the same architecture is limited to __x86_64__ or __i386__ where it is needed (and with a comment explaining why it is needed).",
      "parentUuid": "711f907e_f22d03da",
      "revId": "d2b138e92d4363fa195763f82d7160606b27cd28",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fa19abf4_37ee4a47",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000341
      },
      "writtenOn": "2021-12-17T14:15:09Z",
      "side": 1,
      "message": "I can see it\u0027s used mostly in bios_ia32/long.cpp\nWhich makes it a bit difficult case, as I understand the BIOS loader for x86_64 is actually compiled in with 32-bit mode.\n\nApart from that it doesn\u0027t seem that much difficult to get rid of KERNEL_LOAD_BASE_64_BIT and use a unified KERNEL_LOAD_BASE. (or maybe I\u0027m missing out one more problematic area?)",
      "parentUuid": "dc107fa6_6cf82e3f",
      "revId": "d2b138e92d4363fa195763f82d7160606b27cd28",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "678a2b7a_8131dbec",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000001
      },
      "writtenOn": "2021-12-17T14:24:02Z",
      "side": 1,
      "message": "I think that\u0027s it. The BIOS loader is special in that it can boot both the 64bit and the 32bit version of Haiku, I think. Not sure if it can do so from the same binary or if it needs to be compiled in two different ways.\n\nThis is a special case, in all other architectures we don\u0027t have to do something like that. We may extend that support to EFI as well (so you can boot a 64bit system using a 32bit loader on a machine with a 64bit CPU but 32bit only EFI implementation; or maybe boot a 32bit haiku from a 64bit-only EFI).\n\nOn non-x86 I hope we can avoid such problems, and have either full-64 or full-32 architectures, but not a mix of both. For RISC-V and SPARC we didn\u0027t do a 32bit version at all, and for PPC we are 32bit only at the moment. I don\u0027t know what the plans are for ARM.",
      "parentUuid": "fa19abf4_37ee4a47",
      "revId": "d2b138e92d4363fa195763f82d7160606b27cd28",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    }
  ]
}