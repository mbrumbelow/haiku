{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "c2953706_d2bb3cd5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000173
      },
      "writtenOn": "2023-02-25T16:02:02Z",
      "side": 1,
      "message": "Installer checks whether we used FirstBootPrompt to initiate Installer by checking whether the Deskbar is running in the background. I ultimately used that method, as that is what was used in Installer before.\n\nHowever, another component does this in a different way -- it checks the following:\n- does the FirstBootPrompt binary exist? (I assume this is useful in the context of bootstrapping)\n- does /boot/home/config/settings/Locale\\ settings exist?\n\nLink: https://cgit.haiku-os.org/haiku/commit/data/launch/user?id\u003d1ec3f11d9743f547fd65658d6b56f74cae82e692\n\nI would definitely appreciate some direction in that regard.",
      "revId": "ad3a0fa6e997e25a1b4d5a543bc590d1fcb632ac",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "73bb5c95_6babdcfa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000001
      },
      "writtenOn": "2023-02-25T21:06:20Z",
      "side": 1,
      "message": "That seems correct for Installer. The launch script logic is different because it detects if FirstBootPrompt should be run. The conditions for that are:\n- FirstBootPrompt executable exists (obviously?)\n- No language is selected yet, so we should ask the user to pick one\n\nAfter FirstBootPrompt has run, the locale settings file will be created so this method can\u0027t be used anymore.\n\nAcleaner approach would be for FirstBootPrompt to pass a command line argument to Installer or send it a message when it starts it. Just in case someone has replaced the DeskBar with something else on theis install",
      "parentUuid": "c2953706_d2bb3cd5",
      "revId": "ad3a0fa6e997e25a1b4d5a543bc590d1fcb632ac",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4f33ea72_04a804e3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000173
      },
      "writtenOn": "2023-02-25T21:31:25Z",
      "side": 1,
      "message": "Thanks for the perspective as to how this could be done in a cleaner manner. We should get to that at one point or another if we want to make the Installer more sophisticated. There\u0027s seriously a lot of technical debt over here. Is, for the purpose of this patch, retaining what was previously there and adding a TODO comment somewhere acceptable?",
      "parentUuid": "73bb5c95_6babdcfa",
      "revId": "ad3a0fa6e997e25a1b4d5a543bc590d1fcb632ac",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93e765b9_a8e4d81a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000390
      },
      "writtenOn": "2023-02-27T14:14:34Z",
      "side": 1,
      "message": "This will trigger when you install a second system from a thumb drive.\n\nWhy is this info not in the info document that is right before the partitioning?",
      "revId": "ad3a0fa6e997e25a1b4d5a543bc590d1fcb632ac",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "803f1e1b_e85e565f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000173
      },
      "writtenOn": "2023-02-27T22:48:28Z",
      "side": 1,
      "message": "Please be explicit as to whether you believe that this information should be put exclusively in the information document and that this change should not be included into the system.\n\nIf that\u0027s not the case, I believe this concern is out-of-scope for the time being and I\u0027d gladly follow up with another change that includes this information in the EULA at a later stage.\n\nIf that is the case, I strongly believe that popups are not good enough and \"bad UX\" (a previous change of mine lets people know that they should create a partition using the Be File System, despite a pop-up telling them to do so) and that a long EULA document that even fewer people are going to read would not make the cut either.\n\nMy change does not account for every edge case (you could use a Haiku USB to copy the contents of an already existing Haiku installation in a second partition onto an empty partition, which is actually not far from unrealistic but presumably something an \"advanced\" user would do -- this could be added at a later stage, but educating the user is the priority and the problem I\u0027m trying to tackle here), but will inform the user about this for what I believe to be the most common occurrence of people copying a system with their files -- while not being shown when it\u0027s likely that the user doesn\u0027t have any of their data in the system itself.\n\nThumb drives can also have data stored in them and act as an ordinary Haiku installation when you reboot for the second time, so I believe that this case scenario is actually also valid *enough*, as we can only currently approximate who\u0027s the best target to show it to. While implementing this change, I tried to answer the question of \"who *doesn\u0027t* need to hear this so that we don\u0027t overwhelm them about some \u0027risk\u0027 that does not exist\", instead of finding out about every single person that does. Moreover, \"who is more likely to accidentally copy own data onto another system or another drive\" and \"who is more likely to actually want this\"?",
      "parentUuid": "93e765b9_a8e4d81a",
      "revId": "ad3a0fa6e997e25a1b4d5a543bc590d1fcb632ac",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f8879af1_8957af2c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000390
      },
      "writtenOn": "2023-02-28T04:08:33Z",
      "side": 1,
      "message": "If you only wish to add this info to read then yes, I do believe it should be only in the infotext.\nNobody reads labels, and even less so if you stuff it with this stuff too.\nThat is mostly why the popup is there, and I don\u0027t think that should be changed. The UX is not nuce but the proper solution of adding a \"whole disk\" mode should be preffered rather thsn trying to polish this case that should be removed.\n\nIf you want to convey that the data will be copied in a way that it will actually be read a more comprehensive way would be to have a view that conveys exactly which paths will be copied with the default beeing all.\nFor example a kind of tree view where you can have each row be active/inactive to indicate if it will be copied.",
      "parentUuid": "803f1e1b_e85e565f",
      "revId": "ad3a0fa6e997e25a1b4d5a543bc590d1fcb632ac",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "490342c7_5fd2fe78",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000001
      },
      "writtenOn": "2023-03-02T11:14:01Z",
      "side": 1,
      "message": "\u003e the proper solution of adding a \"whole disk\" mode should be preffered\n\nWhat are you talking about? This is completely independant of the \"whole disk\" mode. This is just a message saying that the whole source partition will be copied, including any extra packages, custom background with pictures of your family/dog/{girl,boy}friend/whatever, ssh keys, saved wifi networks, passwords, and so on. This is certainly unexpected from a tool named \"Installer\", and deserves a warning.\n\nAs for the \"EULA\" (which isn\u0027t one), no one reads it. Indeed, lawyers have successfully trained people to ignore these things. Likewise for popups, Windows users are trained to ignore those because Windows apps tend to use them way too much.\n\nSo, I think our best option here is indeed modifying this text. Let\u0027s go with that.",
      "parentUuid": "f8879af1_8957af2c",
      "revId": "ad3a0fa6e997e25a1b4d5a543bc590d1fcb632ac",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a29aa21f_6f561b0d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000001
      },
      "writtenOn": "2023-03-02T11:14:01Z",
      "side": 1,
      "message": "Thinking about it more, this may not be the right condition to trigger this. What we want to know is if the source partition is \"clean\". The source partition may not be the one the Installer was started from.\n\nHowever, now I\u0027m not sure how we can detect that the source partition is \"clean\". Maybe we can check that SSH host keys are not there? (in [source partition]/system/settings/ssh). If they\u0027re not there it means the system was never booted to desktop and no warning is needed.\n\nMaybe we could even mark such \"clean\" sources in the popup menu?",
      "parentUuid": "4f33ea72_04a804e3",
      "revId": "ad3a0fa6e997e25a1b4d5a543bc590d1fcb632ac",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c66ea35b_c65ae6ef",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000173
      },
      "writtenOn": "2023-03-05T00:45:42Z",
      "side": 1,
      "message": "I get that this condition is much less accurate than the one I used in previous review, but the hypothetical user that you named in your example is probably a user that sort of knows their way around Haiku, as we assume that they have installed Haiku before and that they want to create a new \"Live USB\" or installation of Haiku through another \"Live USB\" -- why would the user even change the source partition to begin with? Of course, there are reasons and we obviously aren\u0027t supposed to make those decisions for the user, but if a user makes such a decision, it\u0027s likely they know what they\u0027re doing. But, if they\u0027re using the Installer from an actual installation, the source disk will be the disk they are using Haiku from. In this case, there\u0027s a much more immediate risk here.\n\nAt this point, I have to admit that my solution is very much lazy that reuses software components that existed before and, indeed, a workaround. I saw a problem that was immediate and, from my perspective, a bit urgent (because of the user\u0027s differing expectations), and I decided to implement it in a way that recycles existing features so as to cover a vast majority of cases, instead of all possible cases. Doing this for all possible cases may be the correct way. I thought of an alternative implementation where the Installer mounts the source drive and check for the locale settings (or what you proposed with the SSH key), runs the UpdateControl function and then immediately unmounts it, but I didn\u0027t have the capacity or the certainty (more on this later) to tackle this problem right now. In general, figuring some sort of definitive way to check whether a partition is clean or not would be much more correct. Nevertheless, I wanted to figure out some sort of opportunity to educate the user at some point, so that they\u0027ll take note of that detail in the future. If my presumptions are correct, this change would probably work well enough.\n\nOn the other hand, we can\u0027t assume that every seasoned user of Haiku is necessarily actively aware that they could use the Installer within their active Haiku installation and that they would ever see this notification. However, we\u0027re still assuming that they\u0027d install Haiku *again* on a system that already has Haiku, which is possibly a very advanced use (not edge!) case.\n\nI think the negative aspect of pushing some sort of \"workaround\" that works most of the time, instead of covering all sorts of the edge cases may mean that we, the developers, may not actually fix the problem and issue the improvements that will cover 100% of all cases. (\"What we have right now works \u0027well enough\u0027 and we have so many other issues to solve, who cares?!\")\n\nI still decided it would be a good idea to push this without consulting all of you as to how I can fix this problem for good, however, as the problem (no users knowing about this) here seems, from my perspective, urgent.\n\nHowever, on the other hand, we have come up with at least three ways (and can probably come up with more) to detect whether a partition is clean or not -- this is a recurring problem that appears again and again across different components of Haiku, and we\u0027ll probably need to tackle it for once and for all if we want to e.g. introduce warnings that ask the user if they are REALLY sure they want to format this drive or if they REALLY want to install a bootloader on a hard drive with empty/no partitions on it or other hypothetical features like that or if we want to do some guided partitioning stuff for e.g. dual booting, or some other stuff like that -- so I\u0027m not really sure (emphasis on really, I seriously don\u0027t know!) as to whether what one could describe as a \"hack\" is actually consequential to the overall quality of Haiku. There\u0027s already some ways that we already work this concept of \"clean\" and \"dirty\" partitions, and there could definitely be more, and that\u0027s something we have to address -- possibly in a system-wide way, instead of coming up with different hacks for each application. That just creates way too many \"moving\" parts and makes the overall codebase potentially more fragile, so to say.\n\n---\n\nTL;DR: The condition was a conscious decision, I am not 100% happy with myself for writing code that \"beats around the bush\" instead of addressing this very wonderful problem you brought up, but I find that the situation where the user boots Haiku from an installation medium and already has partitions to deal with as a situation that would be relatively \"advanced\", and that we could prioritize to teach them at least once, at some point, instead of including very advanced cases if it\u0027s likely that they\u0027d already be aware of this. The chances of this not happening are most likely better than the alternative of being a beginner and not knowing about this at all, but then again, this is a presumption without any basis. Is this good enough? I\u0027m not sure either. I think I\u0027ll let you be the judge of that, I explained my entire thought process so that I don\u0027t have to do so later.",
      "parentUuid": "a29aa21f_6f561b0d",
      "revId": "ad3a0fa6e997e25a1b4d5a543bc590d1fcb632ac",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0177a04c_73f9e566",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000390
      },
      "writtenOn": "2023-03-05T06:21:35Z",
      "side": 1,
      "message": "\u003eThis is just a message saying that the whole source partition will be copied, including any extra packages, custom background with pictures of your family/dog/{girl,boy}friend/whatever, ssh keys, saved wifi networks, passwords, and so on. This is certainly unexpected from a tool named \"Installer\", and deserves a warning.\n\nYes, it is unexpected. But addinng more text makes the installer harder to use, my suggestion wouöd be to have a UI component that conveys this information instead of a text, one that allows you for example to say\n• Copy system settings\n• Copy package history\n• Copy user files\n\nwith the last one beeing expandable to select and deselecr parts of it.\n\nI think such a UI would be much easier to read than even more text in addition to all the other text we have warning about other conditions that nobody reads either",
      "parentUuid": "490342c7_5fd2fe78",
      "revId": "ad3a0fa6e997e25a1b4d5a543bc590d1fcb632ac",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8089aa21_11db7c8e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000390
      },
      "writtenOn": "2023-03-05T06:21:35Z",
      "side": 1,
      "message": "This isn\u0027t urgent, beta5 is still a bit off and \"normal users\" shouldn\u0027t install the nightlies, we have time to do this properly 😊",
      "parentUuid": "c66ea35b_c65ae6ef",
      "revId": "ad3a0fa6e997e25a1b4d5a543bc590d1fcb632ac",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    }
  ]
}