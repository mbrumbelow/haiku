
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <title>Style violations</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <style type="text/css">
    .highlight {
        background: #ffff00;
        color: #000000;
    }

    .linehead {
        background: #ddd;
        font-size: 1px;
    }

    .highlight .linehead {
        background: #ffff00;;
        color: #999;
        text-align: right;
        font-size: 8px;
    }

    .linenumber {
        background: #eee;
        color: #999;
        text-align: right;
    }

    td {
        border-spacing: 0px;
        border-width: 0px;
        padding: 0px
    }

    div.code pre {
        font-family: monospace;
    }

    .tooltip em {
        display:none;
    }

    .tooltip:hover {
        border: 0;
        position: relative;
        z-index: 500;
        text-decoration:none;
    }

    .tooltip:hover em {
        font-style: normal;
        display: block;
        position: absolute;
        top: 20px;
        left: -10px;
        padding: 5px;
        color: #000;
        border: 1px solid #bbb;
        background: #ffc;
        width: auto;
    }</style>
    </head>
    <body>
        <p><b>File list:</b><br/>src/add-ons/disk_systems/btrfs/BTRFSAddOn.cpp<br/></p><hr/><p><b>src/add-ons/disk_systems/btrfs/BTRFSAddOn.cpp</b></p><table><tr><td><pre class="code"><span class="linenumber">   1<br/>   2<br/>   3<br/>   4<br/>   5<br/>   6<br/>   7<br/>   8<br/>   9<br/>  10<br/>  11<br/>  12<br/>  13<br/>  14<br/>  15<br/>  16<br/>  17<br/>  18<br/>  19<br/>  20<br/>  21<br/>  22<br/>  23<br/>  24<br/>  25<br/>  26<br/>  27<br/>  28<br/>  29<br/>  30<br/>  31<br/>  32<br/>  33<br/>  34<br/>  35<br/>  36<br/>  37<br/>  38<br/>  39<br/>  40<br/>  41<br/>  42<br/>  43<br/>  44<br/>  45<br/>  46<br/>  47<br/>  48<br/>  49<br/>  50<br/>  51<br/>  52<br/>  53<br/>  54<br/>  55<br/>  56<br/>  57<br/>  58<br/>  59<br/>  60<br/>  61<br/>  62<br/>  63<br/>  64<br/>  65<br/>  66<br/>  67<br/>  68<br/>  69<br/>  70<br/>  71<br/>  72<br/>  73<br/>  74<br/>  75<br/>  76<br/>  77<br/>  78<br/>  79<br/>  80<br/>  81<br/>  82<br/>  83<br/>  84<br/>  85<br/>  86<br/>  87<br/>  88<br/>  89<br/>  90<br/>  91<br/>  92<br/>  93<br/>  94<br/>  95<br/>  96<br/>  97<br/>  98<br/>  99<br/> 100<br/> 101<br/> 102<br/> 103<br/> 104<br/> 105<br/> 106<br/> 107<br/> 108<br/> 109<br/> 110<br/> 111<br/> 112<br/> 113<br/> 114<br/> 115<br/> 116<br/> 117<br/> 118<br/> 119<br/> 120<br/> 121<br/> 122<br/> 123<br/> 124<br/> 125<br/> 126<br/> 127<br/> 128<br/> 129<br/> 130<br/> 131<br/> 132<br/> 133<br/> 134<br/> 135<br/> 136<br/> 137<br/> 138<br/> 139<br/> 140<br/> 141<br/> 142<br/> 143<br/> 144<br/> 145<br/> 146<br/> 147<br/> 148<br/> 149<br/> 150<br/> 151<br/> 152<br/> 153<br/> 154<br/> 155<br/> 156<br/> 157<br/> 158<br/> 159<br/> 160<br/> 161<br/> 162<br/> 163<br/> 164<br/> 165<br/> 166<br/> 167<br/> 168<br/> 169<br/> 170<br/> 171<br/> 172<br/> 173<br/> 174<br/> 175<br/> 176<br/> 177<br/> 178<br/> 179<br/> 180<br/> 181<br/> 182<br/> 183<br/> 184<br/> 185<br/> 186<br/> 187<br/> 188<br/> 189<br/> 190<br/> 191<br/> 192<br/> 193<br/> 194<br/> 195<br/> 196<br/> 197<br/> 198<br/> 199<br/> 200<br/> 201<br/> 202<br/> 203<br/> 204<br/> 205<br/> 206<br/> 207<br/> 208<br/> 209<br/> 210<br/> 211<br/> 212<br/> 213<br/> 214<br/> 215<br/> 216<br/> 217<br/> 218<br/> 219<br/> 220<br/> 221<br/> 222<br/> 223<br/> 224<br/> 225<br/></span></pre></td><td><pre class="code"><span class="linehead"> </span>/<span class="highlight tooltip">*<em>Operator at line end</em></span><br/><span class="linehead"> </span> * Copyright 2007, Ingo Weinhold, ingo_weinhold@gmx.de.<br/><span class="linehead"> </span> * Copyright 200<span class="highlight tooltip">8-2<em>Missing space after operator</em></span>012, Axel DÃ¶rfler, axeld@pin<span class="highlight tooltip">c-s<em>Missing space after operator</em></span>oftware.de.<br/><span class="linehead"> </span> * Copyright 2012, Gerasim Troeglazov (3dEyes**), 3dEyes@gmail.com<br/><span class="linehead"> </span> * Copyright 2019, Les De Ridder, les@lesderid.net<br/><span class="linehead"> </span> <span class="highlight tooltip">*<em>Operator at line end</em></span><br/><span class="linehead"> </span> * Distributed under the terms of the MIT License.<br/><span class="linehead"> </span> *<span class="highlight tooltip">/<em>Operator at line end</em></span><br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>#include "BTRFSAddOn.h"<br/><span class="linehead"> </span>#include "InitializeParameterEditor.h"<br/><span class="linehead"> </span><br/><span class="linehead"> </span>#include &lt;new&gt;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>#include &lt;Directory.h&gt;<br/><span class="linehead"> </span>#include &lt;List.h&gt;<br/><span class="linehead"> </span>#include &lt;Path.h&gt;<br/><span class="linehead"> </span>#include &lt;Volume.h&gt;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>#include &lt;DiskDeviceTypes.h&gt;<br/><span class="linehead"> </span>#include &lt;MutablePartition.h&gt;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>#include &lt;AutoDeleter.h&gt;<br/><span class="linehead"> </span>#include &lt;StringForSize.h&gt;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>#include &lt;cstdio&gt;<br/><span class="linehead"> </span>#include &lt;debug.h&gt;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>#include "btrfs.h"<br/><span class="linehead"> </span>#include "btrfs_disk_system.h"<br/><span class="linehead"> </span><br/><span class="linehead"> </span>#ifdef ASSERT<br/><span class="linehead"> </span>#	undef ASSERT<br/><span class="linehead"> </span>#endif<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>using std::nothrow;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>static const uint32 kDiskSystemFlags <span class="highlight tooltip">=<em>Operator at line end</em></span><br/><span class="linehead"> </span>	0<br/><span class="linehead"> </span>	| B_DISK_SYSTEM_SUPPORTS_INITIALIZING<br/><span class="linehead"> </span>	| B_DISK_SYSTEM_SUPPORTS_CONTENT_NAME<br/><span class="linehead"> </span>//	| B_DISK_SYSTEM_SUPPORTS_CHECKING<br/><span class="linehead"> </span>//	| B_DISK_SYSTEM_SUPPORTS_REPAIRING<br/><span class="linehead"> </span>//	| B_DISK_SYSTEM_SUPPORTS_CHECKING_WHILE_MOUNTED<br/><span class="linehead"> </span>//	| B_DISK_SYSTEM_SUPPORTS_REPAIRING_WHILE_MOUNTED<br/><span class="linehead"> </span>//	| B_DISK_SYSTEM_SUPPORTS_DEFRAGMENTING<br/><span class="linehead"> </span>//	| B_DISK_SYSTEM_SUPPORTS_DEFRAGMENTING_WHILE_MOUNTED<br/><span class="linehead"> </span>;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>//#define TRACE_BTRFS_ADD_ON<br/><span class="linehead"> </span>#undef TRACE<br/><span class="linehead"> </span>#ifdef TRACE_BTRFS_ADD_ON<br/><span class="linehead"> </span>#	define TRACE(x...) printf(x)<br/><span class="linehead"> </span>#else<br/><span class="linehead"> </span>#	define TRACE(x...) do {} while (false)<br/><span class="linehead"> </span>#endif<br/><span class="linehead"> </span><br/><span class="linehead"> </span>BTRFSAddOn::BTRFSAddOn()<br/><span class="linehead"> </span>	: BDiskSystemAddOn(kPartitionTypeBTRFS, kDiskSystemFlags)<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>BTRFSAddOn::~BTRFSAddOn()<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>status_t<br/><span class="linehead"> </span>BTRFSAddOn::CreatePartitionHandle(BMutablePartition* partition,<br/><span class="linehead"> </span>	BPartitionHandle** _handle)<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>	BTRFSPartitionHandle* handle = new(nothrow) BTRFSPartitionHandle(partition);<br/><span class="linehead"> </span>	if (!handle)<br/><span class="linehead"> </span>		return B_NO_MEMORY;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	status_t error = handle-&gt;Init();<br/><span class="linehead"> </span>	if (error != B_OK) {<br/><span class="linehead"> </span>		delete handle;<br/><span class="linehead"> </span>		return error;<br/><span class="linehead"> </span>	}<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	*_handle = handle;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	return B_OK;<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>bool<br/><span class="linehead"> </span>BTRFSAddOn::CanInitialize(const BMutablePartition* partition)<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>	// We can initialize if the partition is large enough.<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	<span class="highlight tooltip">//T<em>Missing space at comment start</em></span>ODO(lesderid): Check min size<br/><span class="linehead"> </span>	return true;<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>status_t<br/><span class="linehead"> </span><span class="highlight tooltip">BTRFSAddOn::ValidateInitialize(const BMutablePartition* partition, BString* name,<em>Line over 80 char</em></span><br/><span class="linehead"> </span>	const char* parameterString)<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>	if (!CanInitialize(partition) || !name)<br/><span class="linehead"> </span>		return B_BAD_VALUE;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	// truncate, if it is too long<br/><span class="linehead"> </span>	if (name-&gt;Length() &gt;= BTRFS_LABEL_SIZE)<br/><span class="linehead"> </span>		name-&gt;Truncate(BTRFS_LABEL_SIZE - 1);<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	// replace '/' and '\\' by '-'<br/><span class="linehead"> </span>	name-&gt;ReplaceAll('/', '-');<br/><span class="linehead"> </span>	name-&gt;ReplaceAll('\\', '-');<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	// check parameters<br/><span class="linehead"> </span>	initialize_parameters parameters;<br/><span class="linehead"> </span>	status_t error = parse_initialize_parameters(parameterString, parameters);<br/><span class="linehead"> </span>	if (error != B_OK)<br/><span class="linehead"> </span>		return error;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	return B_OK;<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>status_t<br/><span class="linehead"> </span>BTRFSAddOn::Initialize(BMutablePartition* partition, const char* name,<br/><span class="linehead"> </span>	const char* parameterString, BPartitionHandle** _handle)<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>	if (!CanInitialize(partition) || check_volume_name(name) != B_OK)<br/><span class="linehead"> </span>		return B_BAD_VALUE;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	initialize_parameters parameters;<br/><span class="linehead"> </span>	status_t error = parse_initialize_parameters(parameterString, parameters);<br/><span class="linehead"> </span>	if (error != B_OK)<br/><span class="linehead"> </span>		return error;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	BTRFSPartitionHandle* handle = new(nothrow) BTRFSPartitionHandle(partition);<br/><span class="linehead"> </span>	if (!handle)<br/><span class="linehead"> </span>		return B_NO_MEMORY;<br/><span class="linehead"> </span>	ObjectDeleter&lt;BTRFSPartitionHandle&gt; handleDeleter(handle);<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	error = partition-&gt;SetContentType(Name());<br/><span class="linehead"> </span>	if (error != B_OK)<br/><span class="linehead"> </span>		return error;<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	partition-&gt;SetContentName(name);<br/><span class="linehead"> </span>	partition-&gt;SetContentParameters(parameterString);<br/><span class="linehead"> </span>	uint32 blockSize = parameters.blockSize;<br/><span class="linehead"> </span>	partition-&gt;SetBlockSize(blockSize);<br/><span class="linehead"> </span>	partition-&gt;SetContentSize(partition-&gt;Size() / blockSize * blockSize);<br/><span class="linehead"> </span>	partition-&gt;Changed(B_PARTITION_CHANGED_INITIALIZATION);<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	*_handle = handleDeleter.Detach();<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	return B_OK;<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>status_t<br/><span class="linehead"> </span>BTRFSAddOn::GetParameterEditor(B_PARAMETER_EDITOR_TYPE type,<br/><span class="linehead"> </span>	BPartitionParameterEditor** editor)<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>	*editor = NULL;<br/><span class="linehead"> </span>	if (type == B_INITIALIZE_PARAMETER_EDITOR) {<br/><span class="linehead"> </span>		try {<br/><span class="linehead"> </span>			*editor = new InitializeBTRFSEditor();<br/><span class="linehead"> </span>		} catch (std::bad_alloc&amp;) {<br/><span class="linehead"> </span>			return B_NO_MEMORY;<br/><span class="linehead"> </span>		}<br/><span class="linehead"> </span>		return B_OK;<br/><span class="linehead"> </span>	}<br/><span class="linehead"> </span>	return B_NOT_SUPPORTED;<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>BTRFSPartitionHandle::BTRFSPartitionHandle(BMutablePartition* partition)<br/><span class="linehead"> </span>	: BPartitionHandle(partition)<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>BTRFSPartitionHandle::~BTRFSPartitionHandle()<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>status_t<br/><span class="linehead"> </span>BTRFSPartitionHandle::Init()<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>	return B_OK;<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>uint32<br/><span class="linehead"> </span>BTRFSPartitionHandle::SupportedOperations(uint32 mask)<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>	return kDiskSystemFlags &amp; mask;<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>status_t<br/><span class="linehead"> </span>BTRFSPartitionHandle::Repair(bool checkOnly)<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>	TRACE("BTRFSPartitionHandle::Repair(checkOnly=%d)\n", checkOnly);<br/><span class="linehead"> </span>	return B_NOT_SUPPORTED;<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><br/><span class="linehead"> </span><br/><span class="linehead"> </span>status_t<br/><span class="linehead"> </span>get_disk_system_add_ons(BList* addOns)<br/><span class="linehead"> </span>{<br/><span class="linehead"> </span>	BTRFSAddOn* addOn = new(nothrow) BTRFSAddOn;<br/><span class="linehead"> </span>	if (!addOn) {<br/><span class="linehead"> </span>		return B_NO_MEMORY;<br/><span class="linehead"> </span>	}<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	if (!addOns-&gt;AddItem(addOn)) {<br/><span class="linehead"> </span>		delete addOn;<br/><span class="linehead"> </span>		return B_NO_MEMORY;<br/><span class="linehead"> </span>	}<br/><span class="linehead"> </span><br/><span class="linehead"> </span>	return B_OK;<br/><span class="linehead"> </span>}<br/><span class="linehead"> </span><span class="highlight tooltip"></span><br/></pre></td></tr></table>
    </body>
    </html>