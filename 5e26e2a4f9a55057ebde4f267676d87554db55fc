{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "c4ef5297_30f08e35",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-01-12T20:43:13Z",
      "side": 1,
      "message": "So, https://cgit.haiku-os.org/haiku/commit/src/system/kernel/device_manager/device_manager.cpp?id\u003d34e92438724cdb062dae1765fc7e765b44f51ac7 broke virtio disks on qemu-system-riscv64.\n\nI ran a trace of the virtio_block driver, and every bus is \"generic\" or \"fdt\"  (which isn\u0027t \u003d\u003d to virtio per https://cgit.haiku-os.org/haiku/tree/src/add-ons/kernel/drivers/disk/virtual/virtio_block/virtio_block.cpp#n544",
      "revId": "5e26e2a4f9a55057ebde4f267676d87554db55fc",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "24469c73_651d512a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000023
      },
      "writtenOn": "2023-01-12T21:33:51Z",
      "side": 1,
      "message": "I don\u0027t think that removing a path can fix something actually.",
      "revId": "5e26e2a4f9a55057ebde4f267676d87554db55fc",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5b6b0bfe_a9a1d5b9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-01-12T21:48:10Z",
      "side": 1,
      "message": "So.  The core issue is \"generic\" means \"not a PCI device\" (nothing else sets B_DEVICE_TYPE or B_DEVICE_SUB_TYPE)\n\nSince virtio_mmio isn\u0027t on the PCI bus (it\u0027s discovered by ACPI or FDT), devices on it don\u0027t seem to get iterated when guarded with the \"!generic\" tag.\n\nWe could add it to both cases though?  Seems kinda messy though.",
      "parentUuid": "24469c73_651d512a",
      "revId": "5e26e2a4f9a55057ebde4f267676d87554db55fc",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "25f34a1f_3e1f610d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-01-12T21:50:03Z",
      "side": 1,
      "message": "With that said, I feel like you might be \"fixing\" the RNG thing incorrectly.   Once thing I noticed was a lack of a B_DEVICE_BUS of \"virtio\" on virtio_pci, while virtio_mmio sets B_DEVICE_BUS to \"virtio\"\n\nRelated to your issue?",
      "parentUuid": "5b6b0bfe_a9a1d5b9",
      "revId": "5e26e2a4f9a55057ebde4f267676d87554db55fc",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9a6afe01_2e59b9bb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2023-01-12T21:50:56Z",
      "side": 1,
      "message": "```\ndiff --git a/src/add-ons/kernel/busses/virtio/virtio_pci/virtio_pci.cpp b/src/add-ons/kernel/busses/virtio/virtio_pci/virtio_pci.cpp\nindex 05e0c57175..7a69a92a0b 100644\n--- a/src/add-ons/kernel/busses/virtio/virtio_pci/virtio_pci.cpp\n+++ b/src/add-ons/kernel/busses/virtio/virtio_pci/virtio_pci.cpp\n@@ -584,8 +584,9 @@ static status_t\n register_device(device_node* parent)\n {\n        device_attr attrs[] \u003d {\n-               {B_DEVICE_PRETTY_NAME, B_STRING_TYPE, {.string \u003d \"Virtio PCI\"}},\n-               {}\n+               { B_DEVICE_PRETTY_NAME, B_STRING_TYPE, {.string \u003d \"Virtio PCI\"} },\n+               { B_DEVICE_BUS,         B_STRING_TYPE, {.string \u003d \"virtio\"} },\n+               { NULL }\n        };\n \n        return gDeviceManager-\u003eregister_node(parent, VIRTIO_PCI_DEVICE_MODULE_NAME,\n```",
      "revId": "5e26e2a4f9a55057ebde4f267676d87554db55fc",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    }
  ]
}