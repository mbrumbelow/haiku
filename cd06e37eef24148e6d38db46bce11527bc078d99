{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "eefb3666_186c9b35",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3730,
      "author": {
        "id": 1000011
      },
      "writtenOn": "2025-02-18T18:37:07Z",
      "side": 1,
      "message": "Why not just check if fMenuSem \u003c 0?",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6143e39_c33af9fb",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3730,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2025-02-18T19:05:36Z",
      "side": 1,
      "message": "We don\u0027t want the MenusBeginning() to trigger if fMenuSem \u003d\u003d B_INTERRUPTED or B_WOULD_BLOCK or B_TIMED_OUT, only if no semaphore exists. We delete it if is does exist when we\u0027re done so it shouldn\u0027t exist unless you call this more than once within the timeout period.",
      "parentUuid": "eefb3666_186c9b35",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3268a594_7ba591db",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3730,
      "author": {
        "id": 1000011
      },
      "writtenOn": "2025-02-18T19:14:28Z",
      "side": 1,
      "message": "How would this method ever be called more than once simultaneously? It should only happen from the Window event loop, right? So why do we need a guard here?",
      "parentUuid": "a6143e39_c33af9fb",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e2b357ff_c5a3dc2c",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3730,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2025-02-18T19:18:17Z",
      "side": 1,
      "message": "This won\u0027t happen more that once simultaneously but it can get called again and again very quickly, like if you hold the B_DELETE button down. So the guard is only against this being called repeatedly.",
      "parentUuid": "3268a594_7ba591db",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5014a0a7_8bc23cf2",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3730,
      "author": {
        "id": 1000011
      },
      "writtenOn": "2025-02-18T19:20:57Z",
      "side": 1,
      "message": "We absolutely should not guard against shortcuts being executed rapidly, that sounds like a perfectly legitimate usecase. So this should not be fixed this way at all.",
      "parentUuid": "e2b357ff_c5a3dc2c",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "008e706f_c074d322",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3730,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2025-02-18T19:24:02Z",
      "side": 1,
      "message": "We allow shortcuts to be executed rapidly, we just don\u0027t allow looking for new shortcuts in MenusBeginning() rapidly.",
      "parentUuid": "5014a0a7_8bc23cf2",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b0b74bc6_48999690",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3730,
      "author": {
        "id": 1000011
      },
      "writtenOn": "2025-02-18T19:36:32Z",
      "side": 1,
      "message": "The timeout isn\u0027t good, though. We should just call MenusBeginning() every time. In most cases the method does nothing, and applications which do something in there should expect it to be called rapidly sometimes. If Tracker wants to add a \"debounce\" and only re-check every so often, that\u0027s fine, but that\u0027s on Tracker to add. And it wouldn\u0027t need a semaphore; just check the last time we scanned for new addons with system_time().",
      "parentUuid": "008e706f_c074d322",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b262d20d_9e0258ec",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3769,
      "author": {
        "id": 1000011
      },
      "writtenOn": "2025-02-18T18:37:07Z",
      "side": 1,
      "message": "Why do we need to protect against it happening again?",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5c32da59_cf424d60",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3769,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2025-02-18T19:05:36Z",
      "side": 1,
      "message": "No, because acquire_sem_etc() will return B_INTERRUPTED while it is acquiring the semaphore. Once the timeout is reached we can call MenusBeginning() again.\n\nWe only want to call MenusBeginning() the first time this is called but I\u0027m not sure if applications are going to add shortcuts later on thus we do this each time. The case where this crashes is if you send B_DELETE over and over again by holding it down and so it rebuilds the add-ons menus over and over again. The timeout on acquiring the semaphor prevents this from happening too fast and thus the crash.",
      "parentUuid": "b262d20d_9e0258ec",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "091c7b41_60fd5f5b",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3769,
      "author": {
        "id": 1000011
      },
      "writtenOn": "2025-02-18T19:14:28Z",
      "side": 1,
      "message": "Tracker rebuilding menus over and over again sounds like a Tracker bug? Adding a timeout in this method seems like the wrong way to go.",
      "parentUuid": "5c32da59_cf424d60",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "044ae41e_c50a8107",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3769,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2025-02-18T19:18:17Z",
      "side": 1,
      "message": "It is a Tracker bug, but unfortunately Add-ons don\u0027t send any kind of message that they\u0027ve loaded so the best we can do right now is to look for new add-ons on MenusBeginning().",
      "parentUuid": "091c7b41_60fd5f5b",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1460de4c_a850b51c",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3769,
      "author": {
        "id": 1000011
      },
      "writtenOn": "2025-02-18T19:20:57Z",
      "side": 1,
      "message": "That doesn\u0027t explain how crashes happen when holding keys down, though.",
      "parentUuid": "044ae41e_c50a8107",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b624c880_9af9f698",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3769,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2025-02-18T19:24:02Z",
      "side": 1,
      "message": "Sure it does, because the Add-ons menu is rebuilt each time you call MenusBeginning() and menus crash when menu items are added and deleted too fast.",
      "parentUuid": "1460de4c_a850b51c",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0c19f363_3d45afb4",
        "filename": "src/kits/interface/Window.cpp",
        "patchSetId": 1
      },
      "lineNbr": 3769,
      "author": {
        "id": 1000011
      },
      "writtenOn": "2025-02-18T19:36:32Z",
      "side": 1,
      "message": "Menus should not crash in that scenario! Anyway the debug report isn\u0027t in menus at all, it looks like a Tracker bug. The guarded heap may help with determining what it really is.",
      "parentUuid": "b624c880_9af9f698",
      "revId": "cd06e37eef24148e6d38db46bce11527bc078d99",
      "serverId": "40b9299a-d8a8-485d-9b01-e6d3f45eefb5"
    }
  ]
}