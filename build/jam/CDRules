rule BuildHaikuCD haikuCD : elTorito : scripts
{
	# BuildHaikuCD <haiku cd> : <elTorito> : <scripts> ;

	local mainScript = build_haiku_image ;
	SEARCH on $(mainScript) = [ FDirName $(HAIKU_TOP) build scripts ] ;

	# x86 uses an "El Torito" boot sector (our bootFloppy in most cases)
	EL_TORITO on $(haikuCD) = $(elTorito) ;

	Depends $(haikuCD) : $(mainScript) $(scripts) ;
	Depends $(haikuCD) : $(elTorito) ;

	BuildHaikuCD1 $(haikuCD) : $(mainScript) $(scripts:R=$(HAIKU_ABSOLUTE_OUTPUT_DIR)) ;
}

actions BuildHaikuCD1
{
	export cdImagePath="$(1)"
	export cdElTorito="$(EL_TORITO)"

	$(2[1]) $(2[2-])
}
